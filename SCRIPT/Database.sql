
IF DB_ID('QL_DH_GH') IS NOT NULL
	DROP DATABASE QL_DH_GH
GO
CREATE DATABASE QL_DH_GH
GO 

USE QL_DH_GH
GO 
-- Accounts
CREATE TABLE ACCOUNT
(
	MAACC VARCHAR(10),
	TENDANGNHAP VARCHAR(50) NOT NULL,
	MATKHAU VARCHAR(50) NOT NULL,
	LOAIACC INT NOT NULL

	CONSTRAINT PK_ACCOUNT
	PRIMARY KEY (MAACC)
)
GO


CREATE TABLE DOITAC(
	ID_DOITAC VARCHAR(10) NOT NULL,
	TEN NVARCHAR(100),
	NG_DAIDIEN NVARCHAR(50),
	THANHPHO NVARCHAR(50),
	QUAN NVARCHAR(50),
	SL_CHINHANH INT,
	SL_DONMOINGAY INT,
	LOAI_AMTHUC NVARCHAR(50),
	DIACHI_KD NVARCHAR(100),

	CONSTRAINT PK_DOITAC PRIMARY KEY(ID_DOITAC)
)

CREATE TABLE DT_SDT(
	ID_DOITAC VARCHAR(10) NOT NULL,
	SDT VARCHAR(10) NOT NULL,

	CONSTRAINT PK_DT_SDT PRIMARY KEY(ID_DOITAC,SDT)
)

CREATE TABLE CHINHANH_DK(
	ID_CHINHANH VARCHAR(10) NOT NULL,
	TEN_CHINHANH NVARCHAR(100),
	DIACHI NVARCHAR(100),
	SDT VARCHAR(10),
	DOITAC VARCHAR(10),
	TINHTRANG NVARCHAR(50),
	THOIGIANMO TIME,
	THOIGIANDONG TIME,

	CONSTRAINT PK_CHINHANH_DK PRIMARY KEY(ID_CHINHANH)
)

CREATE TABLE DOANHSO(
	ID_CHINHANH VARCHAR(10) NOT NULL,
	THANG INT NOT NULL,
	NAM INT NOT NULL,
	DOANHSO MONEY,

	CONSTRAINT PK_DOANHSO PRIMARY KEY(ID_CHINHANH,THANG,NAM)
)

CREATE TABLE NHANVIEN(
	ID_NHANVIEN VARCHAR(10) NOT NULL,
	TENNHANVIEN NVARCHAR(50),
	EMAIL VARCHAR(50),
	NGAYSINH DATE,
	CHUCVU NVARCHAR(50),
	SDT VARCHAR(10),
	DIACHI NVARCHAR(100),
	LUONG MONEY,

	CONSTRAINT PK_NHANVIEN PRIMARY KEY(ID_NHANVIEN)
)

CREATE TABLE HOPDONG(
	ID_HOPDONG VARCHAR(10) NOT NULL,
	MST VARCHAR(20),
	NG_DAIDIEN NVARCHAR(50),
	SL_CHINHANHDK INT,
	SO_TAIKHOAN VARCHAR(20),
	NGANHANG VARCHAR(50),
	NGAYBATDAUDK DATE,
	NGAYKETTHUCDK DATE,
	TINHTRANG INT,
	DOITAC VARCHAR(10),
	THOIHANHOPDONG INT,
	CONSTRAINT PK_HOPDONG PRIMARY KEY(ID_HOPDONG)
)


CREATE TABLE NHANVIEN_HOPDONG(
	HOPDONG VARCHAR(10) NOT NULL,
	NHANVIEN VARCHAR(10) NOT NULL,
	NGAYKIKET DATE,
	
	CONSTRAINT PK_NV_HD PRIMARY KEY(HOPDONG,NHANVIEN)
)

CREATE TABLE MONAN(
	TENMON VARCHAR(10) NOT NULL,
	MIEUTAMON NVARCHAR(100),
	LOAIMONAN NVARCHAR(50),
	GIA MONEY,
	CHINHANH VARCHAR(10),
	SL_TON INT,

	CONSTRAINT PK_MONAN PRIMARY KEY(TENMON)
)

CREATE TABLE DONHANG(
	ID_DONHANG VARCHAR(10) NOT NULL,
	NGAYLAP DATE,
	DIACHIGIAOHANG NVARCHAR(100),
	SDT_NHANHANG VARCHAR(10),
	PHIVANCHUYEN MONEY,
	PHUONGTHUCTHANHTOAN NVARCHAR(50),
	TONGTIEN MONEY,
	TRANGTHAIXULY NVARCHAR(50),
	CHINHANH VARCHAR(10),
	PHANHOI NVARCHAR(100),
	KHACHHANG VARCHAR(10),
	TRANGTHAIVANCHUYEN NVARCHAR(50),

	CONSTRAINT PK_DONHANG PRIMARY KEY(ID_DONHANG)
)


CREATE TABLE CT_MONDAT(
	DONHANG VARCHAR(10) NOT NULL,
	MONAN VARCHAR(10) NOT NULL,
	SOLUONG INT,
	TUYCHON NVARCHAR(50),

	CONSTRAINT PK_CT_MONDAT PRIMARY KEY(DONHANG,MONAN)
)

CREATE TABLE TAIXE (
	ID_TAIXE VARCHAR(10) NOT NULL,
	HOTEN NVARCHAR(50),
	CMND VARCHAR(20) UNIQUE,
	SDT VARCHAR(10),
	DIACHI NVARCHAR(100),
	BIENSOXE VARCHAR(20),
	KHUVUC_HOATDONG NVARCHAR(50),
	SOTAIKHOAN VARCHAR(20),
	NGANHANG NVARCHAR(50),
	PHITHUECHAN MONEY,

	CONSTRAINT PK_TAIXE PRIMARY KEY(ID_TAIXE)
)

CREATE TABLE KHACHHANG(
	ID_KHACHHANG VARCHAR(10) NOT NULL,
	HOTEN NVARCHAR(50),
	SDT_KH VARCHAR(10),
	DIACHI NVARCHAR(100),

	CONSTRAINT PK_KHACHHANG PRIMARY KEY (ID_KHACHHANG)
)



CREATE TABLE CT_VANCHUYEN(
	ID_VANCHUYEN VARCHAR(10) NOT NULL,
	THOIGIANGIAO TIME,
	THOIGIANNHAN TIME,
	DON VARCHAR(10),
	TAIXE VARCHAR(10),

	CONSTRAINT PK_TRANGTHAIVANCHUYEN PRIMARY KEY(ID_VANCHUYEN)
)


--FOREIGN KEYS
--		DOITAC TABLE

--		NHANVIEN_HOPDONG TABLE
ALTER TABLE NHANVIEN_HOPDONG
ADD CONSTRAINT FK_HD_NVHD FOREIGN KEY(HOPDONG) REFERENCES HOPDONG(ID_HOPDONG)

ALTER TABLE NHANVIEN_HOPDONG
ADD CONSTRAINT FK_NV_NVHD FOREIGN KEY(NHANVIEN) REFERENCES NHANVIEN(ID_NHANVIEN)


--		HOPDONG TABLE
ALTER TABLE HOPDONG
ADD CONSTRAINT FK_DT_HOPDONG FOREIGN KEY(DOITAC) REFERENCES DOITAC(ID_DOITAC)

--		DT_SDT TABLE
ALTER TABLE DT_SDT
ADD CONSTRAINT FK_DT_DT_SDT FOREIGN KEY(ID_DOITAC) REFERENCES DOITAC(ID_DOITAC)


--		CHINHANH_DK TABLE
ALTER TABLE CHINHANH_DK
ADD CONSTRAINT FK_DOITAC_CNDK FOREIGN KEY(DOITAC) REFERENCES DOITAC(ID_DOITAC)


--		DOANHSO TABLE
ALTER TABLE DOANHSO
ADD CONSTRAINT FK_CN_DS FOREIGN KEY(ID_CHINHANH) REFERENCES CHINHANH_DK(ID_CHINHANH)


--		MONAN TABLE
ALTER TABLE MONAN
ADD CONSTRAINT FK_CHINHANH_MA FOREIGN KEY (CHINHANH) REFERENCES CHINHANH_DK(ID_CHINHANH)



--		CT_MONDAT TABLE
ALTER TABLE CT_MONDAT
ADD CONSTRAINT FK_DONHANG_CTMD FOREIGN KEY(DONHANG) REFERENCES DONHANG(ID_DONHANG)

ALTER TABLE CT_MONDAT
ADD CONSTRAINT FK_MONAN_CTMD FOREIGN KEY(MONAN) REFERENCES MONAN(TENMON)
	
--		DONHANG TABLE
ALTER TABLE DONHANG
ADD CONSTRAINT FK_KH_DH FOREIGN KEY(KHACHHANG) REFERENCES KHACHHANG(ID_KHACHHANG)



--		KHACHHANG TABLE


--		TRANGTHAIVANCHUYEN TABLE
ALTER TABLE CT_VANCHUYEN
ADD CONSTRAINT FK_TAIXE_TTVC FOREIGN KEY(TAIXE) REFERENCES TAIXE(ID_TAIXE)

ALTER TABLE CT_VANCHUYEN
ADD CONSTRAINT FK_DON_TTVC FOREIGN KEY(DON) REFERENCES DONHANG(ID_DONHANG)

--thêm mới
ALTER TABLE KHACHHANG
ADD
	CONSTRAINT FK_KH_ACC
	FOREIGN KEY (ID_KHACHHANG)
	REFERENCES ACCOUNT(MAACC)
GO



-- thêm mới
ALTER TABLE TAIXE
ADD
	CONSTRAINT FK_TX_ACC
	FOREIGN KEY (ID_TAIXE)
	REFERENCES ACCOUNT(MAACC)
GO


-- thêm mới
ALTER TABLE DOITAC
ADD
	CONSTRAINT FK_DT_ACC
	FOREIGN KEY (ID_DOITAC)
	REFERENCES ACCOUNT(MAACC)
GO


INSERT ACCOUNT
VALUES  ('KH0001','KH0001','KH001', 1),
		('KH0002','KH0002','KH002', 1),
		('KH0003','KH0003','KH003', 1),
		('KH0004','KH0004','KH004', 1),
		('KH0005','KH0005','KH005', 1),
		('DT0001','DT0001','DT001',0),
		('DT0002','DT0002','DT002',0),
		('DT0003','DT0003','DT003',0),
		('DT0004','DT0004','DT004',0),
		('DT0005','DT0005','DT005',0),
		('TX0001','TX0001','TX001', 3),
		('TX0002','TX0002','TX002', 3),
		('TX0003','TX0003','TX003', 3),
		('TX0004','TX0004','TX004', 3),
		('TX0005','TX0005','TX005', 3),
		('AD0001','AD0001','AD001', 4),
		('AD0002','AD0002','AD002', 4)

INSERT DOITAC
VALUES  ('DT0001',N'Quán ăn Thân Thương',N'Lâm Thương',N'TP Hồ Chí Minh',N'Quận 1',2,50,N'Cơm',N'32 Đinh Điền, Phường 2, Quận Tân Bình, TP Hồ Chí Minh'),
		('DT0002',N'Quán ăn Đậu Nành',N'Lý Hảo',N'TP Hồ Chí Minh',N'Quận 2',1,100,N'Cơm',N'95A Phan Đăng Lưu, Phường 07, Quận Phú Nhuận, TP Hồ Chí Minh'),
		('DT0003',N'Trà sữa Meet Tea',N'Nguyễn Phú',N'TP Hồ Chí Minh',N'Thành phố Thủ Đức',1,50,N'Giải khát',N'29-31 Đinh Bộ Lĩnh, Phường 24, Quận Bình Thạnh, TP Hồ Chí Minh'),
		('DT0004',N'SIX COFFEE',N'Trần Tường',N'TP Hồ Chí Minh',N'Quận 5',1,100,N'Giải khát',N'213 Man Thiện, Phường Hiệp Phú, Thành phố Thủ Đức, TP Hồ Chí Minh'),
		('DT0005',N'Quán cơm Đồng Tâm',N'Lê Hà Hiền Thu',N'TP Hồ Chí Minh',N'Quận 4',1,100,N'Cơm',N'4/9B Đặng Thúc Vịnh, Xã Đông Thạnh, Huyện Hóc Môn, TP Hồ Chí Minh')

INSERT NHANVIEN
VALUES  ('NV0001',N'Trần Thị Thúy Diễm','NV0001@gmail.com','2000-12-01',N'Nhân viên','0399123456',N'Số 1/57, Khu phố Bình Thuận 2, Phường Thuận Giao, Thành phố Thuận An, Tỉnh Bình Dương',3000),
		('NV0002',N'Lê Hương Lài','NV0002@gmail.com','1999-04-05',N'Quản lý','0898123456',N'107 KNO Tân Đông Hiệp, Phường Tân Đông Hiệp, Thành phố Dĩ An, Tỉnh Bình Dương',2950),
		('NV0003',N'Trần Thu Trang','NV0003@gmail.com','1990-05-29',N'Giám đốc marketing','0859123456',N'Số 19 đường Hoàng Hoa Thám, Phường Phú Lợi, Thành phố Thủ Dầu Một, Tỉnh Bình Dương',5000),
		('NV0004',N'Nguyễn Thúy Quỳnh','NV0004@gmail.com','1999-04-04',N'Nhân viên','0995123456',N'965/36/16 Quang Trung, Phường 14, Quận Gò Vấp, TP Hồ Chí Minh',2910),
		('NV0005',N'Đào Diễm Hương','NV0005@gmail.com','2002-12-03',N'Nhân viên thực tập','0325123456',N'48/15/13 Hồ Biểu Chánh, Phường 11, Quận Phú Nhuận, TP Hồ Chí Minh',2000)

INSERT KHACHHANG
VALUES  ('KH0001',N'Nguyễn Thúy Liễu','0392987654',N'86/8a Nguyễn Văn Trỗi, Phường 08, Quận Phú Nhuận, TP Hồ Chí Minh'),
		('KH0002',N'Lê Văn Long','0899987654',N'27 Đường 13, Khu phố 1, Phường Bình Thọ, Thành phố Thủ Đức, TP Hồ Chí Minh'),
		('KH0003',N'Trần Văn Mai','0342987654',N'843/14 Nguyễn Kiệm, Phường 3, Quận Gò Vấp, TP Hồ Chí Minh'),
		('KH0004',N'Liễu Thái Thanh Hà','0356987654',N'73/3 Đường số 67, Phường Cát Lái, Thành phố Thủ Đức, TP Hồ Chí Minh'),
		('KH0005',N'Mai Anh Đào','0887987654',N'56/17/7 Huỳnh Thị Hai, Phường Tân Chánh Hiệp, Quận 12, TP Hồ Chí Minh')
INSERT HOPDONG
VALUES  ('HD0001','MST0001',N'Lâm Thương',2,'1234567',N'VP BANK','2021-01-01','2025-12-31',1,'DT0001',1),
		('HD0002','MST0002',N'Lý Hảo',1,'2356787',N'VP BANK','2019-01-01','2021-01-01',1,'DT0002',2),
		('HD0003','MST0003',N'Lý Hảo',1,'2356787',N'VP BANK','2022-01-01','2025-01-01',0,'DT0002',1),
		('HD0004','MST0004',N'Lý Hảo',1,'2356787',N'VP BANK','2023-01-01','2024-12-31',0,'DT0002',3),
		('HD0005','MST0005',N'Nguyễn Phú',1,'3452345',N'AGRIBANK','2022-01-01','2023-12-31',1,'DT0003',3),
		('HD0006','MST0006',N'Trần Tường',1,'1234569',N'Ngân hàng Hàng Hải Việt Nam','2020-01-01','2023-12-31',1,'DT0004',1),
		('HD0007','MST0007',N'Lê Hà Hiền Thu',1,'987654433',N'Sacombank','2022-01-01','2023-12-31',1,'DT0005',4)


INSERT NHANVIEN_HOPDONG
VALUES  ('HD0001','NV0003','2020-12-01'),
		('HD0002','NV0005','2018-11-08'),
		('HD0005','NV0001','2021-12-19'),
		('HD0006','NV0004','2019-12-02'),
		('HD0007','NV0001','2021-05-31')

INSERT  DT_SDT
VALUES  ('DT0001','0999543678'),
		('DT0001','0998543678'),
		('DT0002','0333543678'),
		('DT0003','0324543678'),
		('DT0004','0911543678'),
		('DT0005','0922543678')



INSERT DONHANG
VALUES  ('DH0001','2022-10-01',N'86/8a Nguyễn Văn Trỗi, Phường 08, Quận Phú Nhuận, TP Hồ Chí Minh','0392987654',10,N'Tiền mặt',55,N'Nhận đơn','CN0001',N'LIKE','KH0001',N'Giao hàng thành công'),
		('DH0002','2022-01-01',N'73/3 Đường số 67, Phường Cát Lái, Thành phố Thủ Đức, TP Hồ Chí Minh','0356987654',11,N'Chuyển khoản',51,N'Chưa nhận đơn','CN0003',N'RATING','KH0004',N'Chờ nhận'),
		('DH0003','2021-11-19',N'843/14 Nguyễn Kiệm, Phường 3, Quận Gò Vấp, TP Hồ Chí Minh','0342987654',11,N'Chuyển khoản',66,N'Nhận đơn','CN0002',N'DISLIKE','KH0003',N'Giao hàng thành công'),
		('DH0004','2022-09-18',N'56/17/7 Huỳnh Thị Hai, Phường Tân Chánh Hiệp, Quận 12, TP Hồ Chí Minh','0887987654',8,N'Tiền mặt',33,N'Nhận đơn','CN0004',N'LIKE','KH0005',N'Giao hàng thành công')
INSERT CT_MONDAT
VALUES  ('DH0001','MA0001',1,N'Cơm thêm'),
		('DH0001','MA0002',1,N'Không hành'),
		('DH0002','MA0008',1,N'Size L'),
		('DH0002','MA0009',1,N'Size M'),
		('DH0003','MA0004',1,N'Cơm thêm'),
		('DH0003','MA0005',1,N'Cơm thêm'),
		('DH0003','MA0006',1,N'Không'),
		('DH0004','MA0012',1,N'Không hành')
INSERT MONAN
VALUES  ('MA0001',N'Mì xào bò',N'Mì',20,'CN0001',10),
		('MA0002',N'Phở bò tái',N'Phở',25,'CN0001',11),
		('MA0003',N'Cơm gà trứng opla',N'Cơm',25,'CN0001',5),
		('MA0004',N'Cơm cuộn chiên giòn',N'Cơm',30,'CN0002',6),
		('MA0005',N'Cơm gà xào chua cay',N'Cơm',25,'CN0002',9),
		('MA0006',N'Trứng luộc',N'Thịt',10,'CN0002',10),
		('MA0007',N'Trà sữa olong',N'Trà sữa',20,'CN0003',0),
		('MA0008',N'Sữa tươi trân châu đường đen',N'Sữa tươi',20,'CN0003',0),
		('MA0009',N'Đá bào kem tươi',N'Đá bào',20,'CN0003',2),
		('MA0010',N'Bạc xỉu đá',N'Cà phê',20,'CN0004',10),
		('MA0011',N'Cà phê sữa',N'Cà phê',20,'CN0004',10),
		('MA0012',N'Cháo bát bảo',N'Cháo',25,'CN0005',25)
INSERT CHINHANH_DK
VALUES  ('CN0001',N'Quán ăn Thân Thương',N'32 Đinh Điền, Phường 2, Quận Tân Bình, TP Hồ Chí Minh','0987876543','DT0001',N'BINH THUONG','5:00','21:00'),
		('CN0002',N'Quán ăn Thân Thương 2',N'200/51 Xóm Chiếu, Phường 15, Quận 4, TP Hồ Chí Minh','0362876543','DT0001',N'BINH THUONG','5:00','21:00'),
		('CN0003',N'Quán ăn Đậu Nành',N'95A Phan Đăng Lưu, Phường 07, Quận Phú Nhuận, TP Hồ Chí Minh','0234876543','DT0002',N'BINH THUONG','5:00','21:00'),
		('CN0004',N'Trà sữa Meet Tea',N'29-31 Đinh Bộ Lĩnh, Phường 24, Quận Bình Thạnh, TP Hồ Chí Minh','0324876543','DT0003',N'BINH THUONG','5:00','21:00'),
		('CN0005',N'SIX COFFEE',N'213 Man Thiện, Phường Hiệp Phú, Thành phố Thủ Đức, TP Hồ Chí Minh','0396876543','DT0004',N'BINH THUONG','5:00','21:00'),
		('CN0006',N'Quán cơm Đồng Tâm',N'4/9B Đặng Thúc Vịnh, Xã Đông Thạnh, Huyện Hóc Môn, TP Hồ Chí Minh','0999876543','DT0005',N'BINH THUONG','5:00','21:00')

INSERT TAIXE
VALUES  ('TX0001',N'Trần Văn Hùng','215570000','0352345678',N'581 Đào Sư Tích, Xã Phước Lộc, Huyện Nhà Bè, TP Hồ Chí Minh','98-K1 028.97',N'Huyện Nhà Bè, TP Hồ Chí Minh','500012345',N'Vietcombank',3000),
		('TX0002',N'Lê Anh Thông','215570001','0892345678',N'200/51 Xóm Chiếu, Phường 15, Quận 4, TP Hồ Chí Minh','99-H7 706.34',N'Quận 4, TP Hồ Chí Minh','62783458456',N'TP Bank',1200),
		('TX0003',N'Mai Tiến Dũng','215570002','0999345678',N'4/9B Đặng Thúc Vịnh, Xã Đông Thạnh, Huyện Hóc Môn, TP Hồ Chí Minh','63-B9 999.99',N'Huyện Hóc Môn, TP Hồ Chí Minh','34565436765',N'MB Bank',1250),
		('TX0004',N'Trần Thanh Tuyền','215570003','0936345678',N'213 Man Thiện, Phường Hiệp Phú, Thành phố Thủ Đức, TP Hồ Chí Minh','63-B1 842.40',N'Thành phố Thủ Đức, TP Hồ Chí Minh','3456543',N'Agribank',1300),
		('TX0005',N'Lê Vi Long','215570004','0987345678',N'8A/G2 Thái Văn Lung, Phường Bến Nghé, Quận 1, TP Hồ Chí Minh','65-D1 388.99',N'Quận 1, TP Hồ Chí Minh','1234146356',N'Bản Việt',2000)

INSERT CT_VANCHUYEN
VALUES  ('VC0001','12:00','12:30','DH0001','TX0003'),
		('VC0002','8:00','8:45','DH0003','TX0001'),
		('VC0003','18:12','18:33','DH0004','TX0002'),
		('VC0004','11:01','12:00','DH0002','TX0005')



SELECT * FROM DOITAC
